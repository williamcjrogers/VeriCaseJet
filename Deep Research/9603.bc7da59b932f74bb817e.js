(self.webpackChunkEgnyte_CommonUI=self.webpackChunkEgnyte_CommonUI||[]).push([[9603,140],{799245:function(e,t,o){"use strict";o.d(t,{fn:function(){return we},pN:function(){return Ee},L5:function(){return Fe}});var n=o(420790),r=o(174816),i=o(240701),a=o(943886),s=o(820954),l=o(776327),d=o(762074),c=o(19309),u=o(986456),p=o.n(u),m=o(42594),v=o(307624),h=o(127118),f=o(414111),y=o(661338),b=o(266606),g=o(314990),O=o.n(g);function E(e,t){y.Z.attachTooltip(e,{content:t,updateAnimation:!1})}var w=c.Z.Marionette.Layout.extend({_treeView:null,_operation:null,moveBtn:null,copyBtn:null,footerBindings:null,toolbarBindings:null,bWasRefresh:!1,template:O(),regions:{tree:"#copy-move-tree",form:"#copy-move-form",permissionsRestore:"#permissions-restore",permissionsRestoreForCopy:"#permissions-restore-copy",permissionsRestoreForMove:"#permissions-restore-move",folderOptions:"#folder-options",advancedCopy:"#advanced-copy"},events:{"click .action-copy:not(.disabled, .danger, .warning, .success)":"_performCopy","click .action-move:not(.disabled, .danger, .warning, .success)":"_performMove","click .action-create-folder:not(.disabled)":"renderCreateNewFolder","click .modal__footer .cancel":"_onCancel","click @ui.advancedCopyBtn":"_onAdvancedCopy"},modelEvents:{operationComplete:"_onOperationComplete",operationError:"_onOperationError",operationPoll:"_onOperationPoll"},ui:{disabledMoveBtn:".disabled-move",moveBtn:".action-move",copyBtn:".action-copy",createFolderBtn:".action-create-folder",toolbar:".copy-move-toolbar",modal:".modal",header:".modal__header",footer:".modal__footer",content:".modal__body",advancedCopyBtn:"#advanced-copy-btn"},initialize:function(e){p().bindAll(this,"showOverwriteDialog","closeCreateNewFolderForm"),p().extend(this,e),this.initFolderTree()},initFolderTree:function(){this.listenTo(this,"modalShown",(function(){this.showFolderTree()}))},serializeData:function(){return this.viewModel.toJSON()},onShow:function(){l.ZP.on(l.ZP.Events.Operation.COPYMOVE.PATH_UPDATE,this.onPathUpdate,this),l.ZP.on(l.ZP.Events.Operation.COPYMOVE.ASYNC_OPERATION_ACCEPTED,this.onAsyncOperationAccepted,this),this.advancedMode&&this.enableAdvancedMode(),this.setCreateFolderTooltip(!1),this.moveBtn=new f.Z({observe:this,trigger:"moveStateChange",el:this.ui.moveBtn}),this.copyBtn=new f.Z({observe:this,trigger:"copyStateChange",el:this.ui.copyBtn}),this.footerBindings=(0,v.Z)(this.ui.footer,{m:this.model}),this.toolbarBindings=(0,v.Z)(this.ui.toolbar,{m:this.model}),this.modalBindings=(0,v.Z)(this.$el,{v:this.viewModel})},enableAdvancedMode:function(){"GDrive"!==this.model.get("source")&&this.model.areAnyFolders()&&(this.controller.shouldAdvancedCopyFlowBeActive()&&this.model.canShowAdvancedCopyButton()&&this.viewModel.showAdvancedCopyButton(),this.showRestorePermissions(),this.showFolderOptions())},showRestorePermissions:function(){var e=this.model,t=e.get("type"),o=this.viewModel.isAdvancedCopyFlowVisible();if(this.viewModel.updateRestorePermsVisibility(),"move"!==t){var n=this.restorePermissionsFactory({copyMoveModel:e,type:"copy",advancedCopy:o,onChange:function(e){this.model.setRestorePermissionsMethodForAction(e,"copy")}.bind(this)});this.permissionsRestoreForCopy.show(n)}if("copy"!==t)if(o){var r;null!==(r=this.permissionsRestoreForMove)&&void 0!==r&&r.currentView&&this.permissionsRestoreForMove.currentView.close()}else{var i=this.restorePermissionsFactory({copyMoveModel:e,type:"move",advancedCopy:o,onChange:function(e){this.model.setRestorePermissionsMethodForAction(e,"move")}.bind(this)});this.permissionsRestoreForMove.show(i)}},showFolderOptions:function(){var e=this.model;if(this.viewModel.updateFolderOptionsVisibility(),this.viewModel.get("folderOptionsVisible")){var t=this.folderOptionsFactory({copyMoveModel:e,onChange:function(e){this.model.set("folderOptionsMode",e)}.bind(this)});this.folderOptions.show(t)}},showFolderTree:function(){var e=this;if(!this.isClosed){this.setCreateFolderBtnDisabled(!0);var t="/Shared";this.model.sourceFolder&&(t=(0,m.DW)(this.model.sourceFolder));var o=this.treeFactory(t,this.tree,{onDestinationSelect:this.onDestinationSelect.bind(this),onOpenFolderError:function(){return e.setCreateFolderBtnDisabled(!1)},documentRoomId:this.documentRoomId,workspaceId:this.workspaceId});this.tree.show(o)}},updateButtonsState:function(e,t,o){this.trigger("".concat(e,"StateChange"),t,o)},_onCancel:function(){this.model.cancel()},_onAdvancedCopy:function(){this.viewModel.isAdvancedCopyFlowVisible()?this.hideAdvancedCopyFlow():this.showAdvancedCopyFlow()},showAdvancedCopyFlow:function(){this.viewModel.toggleAdvancedCopyFlowVisibility(!0),this.showAdvancedCopyPanel(),this.showRestorePermissions(),this.showFolderOptions()},hideAdvancedCopyFlow:function(){this.viewModel.toggleAdvancedCopyFlowVisibility(!1),this.closeAdvancedCopyPanel(),this.showRestorePermissions(),this.showFolderOptions()},showAdvancedCopyPanel:function(){this.model.setAdvancedCopy(!0);var e=this.advancedCopyFactory({copyMoveModel:this.model,onErrorsCleared:function(){this.updateButtonsState(this.model.get("type"),"default"),this.updateCopyMoveButtonAvailability()}.bind(this)});this.advancedCopy.show(e),this.updateCopyMoveButtonAvailability(),this.updateCopyMoveButtonTooltip()},closeAdvancedCopyPanel:function(){this.advancedCopy.close(),this.model.setAdvancedCopy(!1),l.ZP.trigger(l.ZP.Events.Storage.NOTIFICATION.HIDE),this.updateButtonsState(this.model.get("type"),"default"),this.updateCopyMoveButtonAvailability(),this.updateCopyMoveButtonTooltip(),this.viewModel.updateTitle()},_performCopy:function(){this.performAction("copy")},_performMove:function(){this.performAction("move")},performAction:function(e){this.updateButtonsState(e,"processing"),this.model.setRestorePermissionsMethod(this.model.getRestorePermissionsMethodForAction(e)),this.controller.performAction(e,{prevalidate:this.advancedMode,advancedCopy:this.viewModel.isAdvancedCopyFlowVisible()}).fail(this.onPrevalidationError.bind(this))},setCreateFolderBtnDisabled:function(e){this.viewModel.setCreateFolderDisabled(e)},renderCreateNewFolder:function(){this.setCreateFolderBtnDisabled(!0),this.ui.footer.hide();var e=this.model.getSelectedFolder(),t=this.newFolderFormFactory(e,{documentRoomId:this.documentRoomId,workspaceId:this.workspaceId,onNewFolderCreate:function(e){l.ZP.trigger(l.ZP.Events.Storage.FOLDER.ADD,e),this.closeCreateNewFolderForm(),b.Z.track("copyMove: New folder created"),e.has("relativePath")&&e.set("path",e.get("relativePath")),this.setDestination(e)}.bind(this),onNewFolderCancel:this.closeCreateNewFolderForm}),o=t.createFolderForm,n=t.updatePath;this.form.show(o),this.updateCreateNewFolderPath=n},closeCreateNewFolderForm:function(){this.form.close(),this.ui.footer.show(),this.setCreateFolderBtnDisabled(!1),this.updateCreateNewFolderPath=null},onPathUpdate:function(e){l.ZP.trigger(l.ZP.Events.Operation.COPYMOVE.PATH_UPDATED,e)},onPrevalidationError:function(e){var t=e.getError(),o=e.getFailedItems();t?(l.ZP.trigger(l.ZP.Events.Storage.NOTIFICATION.SHOW,"error",t.msg),this.tree.currentView.trigger("refreshOnError")):this.controller.showPrevalidationStatusDialog(this.model,o)},_onOperationError:function(e){var t=e.get("errorReason"),o=e.get("errorCode"),n=e.get("errorMessage"),r=e.get("errorLevel");switch(this.updateButtonsState(e.get("type"),"error",n),o){case 404:this.bWasRefresh=!0,this.tree.currentView.trigger("refreshOnError");break;case 409:if("WARNING"===r)return this.ui.modal.one("hidden",this.showOverwriteDialog),void this.onHide();break;case 412:var i=[{errors:[{code:"PRECONDITION_FAILED",msg:t,level:r}],status:o,msg:t,resource:{path:this.model.destination.get("path"),permissions:this.model.restorePermsMethod,overwrite:this.model.get("overwrite")}}];return void this.controller.showPrevalidationStatusDialog(this.model,i)}(0,d.Gg)("error.".concat(t))&&(t=(0,d.t)("error.".concat(t))),t&&l.ZP.trigger(l.ZP.Events.Storage.NOTIFICATION.SHOW,"error",t)},onAsyncOperationAccepted:function(e){this.controller.showAsyncCopyMoveExplanatoryDialog(e)},showOverwriteDialog:function(){this.controller.showOverwriteDialog(this.model)},_onOperationComplete:function(){setTimeout(this.onHide,500),this.updateButtonsState(this.model.get("type"),"success")},_onOperationPoll:function(){this.model.off("operationPoll",this._operationPoll,this),this.onHide()},setDestination:function(e){this.tree.currentView.setProps({path:(0,m.DW)(e)}),this.onDestinationSelect(e),l.ZP.trigger(l.ZP.Events.Operation.COPYMOVE.PATH_UPDATE,{path:(0,m.DW)(e)})},onDestinationSelect:function(e){function t(t){t.trigger("destinationUpdated",e)}this.model.setDestination(e),h.Z.isUIBound(this.ui)||this.bindUIElements(),this.advancedCopy&&this.advancedCopy.currentView&&t(this.advancedCopy.currentView),this.permissionsRestore&&this.permissionsRestore.currentView&&t(this.permissionsRestore.currentView),this.permissionsRestoreForCopy&&this.permissionsRestoreForCopy.currentView&&t(this.permissionsRestoreForCopy.currentView),this.permissionsRestoreForMove&&this.permissionsRestoreForMove.currentView&&t(this.permissionsRestoreForMove.currentView);var o=this.controller.canCreateFolder();this.setCreateFolderBtnDisabled(!o),this.setCreateFolderTooltip(o),this.viewModel.updateRestorePermsVisibility(),this.showFolderOptions(),this.bWasRefresh||(l.ZP.trigger(l.ZP.Events.Storage.NOTIFICATION.HIDE),this.updateButtonsState("copy","default"),this.updateButtonsState("move","default")),this.bWasRefresh=!1,this.updateCreateNewFolderPath&&this.updateCreateNewFolderPath(this.model.getSelectedFolder().get("path")),this.updateCopyMoveButtonTooltip()},updateCopyMoveButtonTooltip:function(){var e=this.model.checkCopyMovePreconditions(this.model.selectedFolder),t=this.viewModel.getCopyMoveButtonTooltipMessage(e);y.Z.destroyTooltip(this.ui.copyBtn),y.Z.destroyTooltip(this.ui.moveBtn),y.Z.destroyTooltip(this.ui.disabledMoveBtn),t&&(E(this.ui.copyBtn,t),E(this.ui.moveBtn,t)),E(this.ui.disabledMoveBtn,(0,d.t)("copyMove.error.lockedFilesDisabledMove"))},updateCopyMoveButtonAvailability:function(){this.model.trigger("change:canCopy change:canMove")},setCreateFolderTooltip:function(e){y.Z.destroyTooltip(this.ui.createFolderBtn),e||E(this.ui.createFolderBtn,this.viewModel.get("cantCreateFolder"))},onClose:function(){var e,t,o;l.ZP.off(l.ZP.Events.Operation.COPYMOVE.PATH_UPDATE,this.onPathUpdate,this),l.ZP.off(l.ZP.Events.Operation.COPYMOVE.ASYNC_OPERATION_ACCEPTED,this.onAsyncOperationAccepted,this),null===(e=this.footerBindings)||void 0===e||e.unbind(),null===(t=this.toolbarBindings)||void 0===t||t.unbind(),null===(o=this.modalBindings)||void 0===o||o.unbind()}}),F=o(821251),P=o(412615),C=o(639269),I=o(722332),M=o(592279);function T(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=t.documentRoomId,n=void 0===o?null:o,r=t.workspaceId,a=void 0===r?null:r,s=t.onNewFolderCreate,l=void 0===s?function(){}:s,c=t.onNewFolderCancel,u=void 0===c?function(){}:c,p=new I.Z({name:(0,d.t)("copyMove.content.newFolder"),isNewItem:!0,parentFolderID:e.get("id"),parentPath:e.get("path"),processing:!0},{parentFolder:e});return p.url=n?i.Z.DOCUMENT_ROOM.PORTAL.CONTENTS_ITEM({id:e.id,documentRoomId:n}):a?i.Z.CLIENT_PORTAL.WORKSPACES.FSI.ITEM_CONTENTS({workspaceId:a,itemId:e.id}):i.Z.FSI.CONTENTS(e.id),{createFolderForm:new M.Z.Bridge({model:p,onNewFolderCreate:l,onNewFolderCancel:u}),updatePath:function(e){p.set("parentPath",e)}}}var _=o(487462),Z=o(204942),S=o(667294),A=o(619755),R=o.n(A),D=o(799532),N=o(379499),B=o(762144),k=o(232452),V=o(778015);function L(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function x(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?L(Object(o),!0).forEach((function(t){(0,Z.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):L(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function j(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=o.documentRoomId,r=void 0===n?null:n,i=o.workspaceId,a=void 0===i?null:i;return h.Z.createCompatibleReactComponent(B.Z,x(x(x({path:e,container:R()(t.el)[0],customAdapter:r||a?k.Z:void 0},r?{TreeControllerComponent:function(t){return S.createElement(V.H8,(0,_.default)({},t,{rootFolder:{id:r,path:(0,m.$l)(e),folderItemProps:{documentRoomId:r},customAdapter:k.Z}}))}}:null),a?{TreeControllerComponent:function(t){return S.createElement(V.H8,(0,_.default)({},t,{rootFolder:{id:a,path:(0,m.$l)(e),folderItemProps:{workspaceId:a},customAdapter:k.Z}}))}}:null),{},{onInitialFolderData:function(e){var t=new I.Z(e);o.onDestinationSelect(t)},onFolderSelect:function(e){var t=new I.Z(e);o.onDestinationSelect(t)},onFolderSelectError:function(e){o.onOpenFolderError(e)},renderError:function(){return S.createElement("p",{className:"empty-info empty-tree-info"},S.createElement(D.Z,{icon:N.Z9,className:"huge-info-icon"}),S.createElement("br",null),(0,d.t)("copyMove.error.treeLoadFailed"))}}))}var H=o(922222),W=o.n(H),U=o(368354),Y=o(323063),z=o(839365),K=o(601714),G=o(599417),$=o(914312),q=c.Z.Model.extend({defaults:function(){return{title:"",createNewFolder:(0,d.t)("copyMove.button.createNewFolder"),createIn:(0,d.t)("copyMove.content.createIn"),addFolder:(0,d.t)("copyMove.button.addFolder"),folderName:(0,d.t)("copyMove.content.folderName"),targetFolder:(0,d.t)("copyMove.advanced.targetFolder"),cancelButton:(0,d.t)("button.label.cancel"),moveButton:(0,d.t)("button.label.move"),copyButton:(0,d.t)("button.label.copy"),moveInProgress:(0,d.t)("copyMove.button.moveInProgress"),moveDone:(0,d.t)("copyMove.button.moveDone"),moveError:(0,d.t)("copyMove.notices.moveError"),copyInProgress:(0,d.t)("copyMove.button.copyInProgress"),copyDone:(0,d.t)("copyMove.button.copyDone"),copyError:(0,d.t)("copyMove.notices.copyError"),addInProgress:(0,d.t)("copyMove.button.addInProgress"),fixErrors:(0,d.t)("copyMove.button.fixErrors"),noPermissionsToWrite:(0,d.t)("copyMove.error.noPermissionsToWrite"),cantCopyToSubfolder:(0,d.t)("copyMove.error.cantCopyToSubfolder"),sourceCantBeTarget:(0,d.t)("copyMove.error.sourceCantBeTarget"),cantAddFilesToFolder:(0,d.t)("copyMove.error.cantAddFilesToFolder"),cantCreateFolder:(0,d.t)("copyMove.error.cantCreateFolder"),advancedFolderCopy:(0,d.t)("copyMove.advanced.advancedFolderCopy"),backToMoveCopy:(0,d.t)("copyMove.advanced.backToMoveCopy"),backToCopy:(0,d.t)("copyMove.advanced.backToCopy"),advancedCopyButtonTitle:(0,d.t)("copyMove.advanced.advancedFolderCopy"),restorePermsVisible:!1,advancedCopyButtonVisible:!1,advancedCopyFlowVisible:!1,createFolderDisabled:!0,dndNoticeText:(0,d.t)("copyMove.dndNotice.textContent",{context:z.Z.getOSName()})}},initialize:function(e,t){for(var o=arguments.length,n=new Array(o>2?o-2:0),r=2;r<o;r++)n[r-2]=arguments[r];c.Z.Model.prototype.initialize.apply(this,[e,t].concat(n)),this.model=t.model,this.set("name",this.model.get("name")),this.updateTitle()},updateRestorePermsVisibility:function(){var e=this.model.selectedFolder&&this.model.selectedFolder.get("path"),t=!e||W().startsWith(e,I.Z.PRIVATE)||e===I.Z.SHARED,o=this.model.isAnyItemContainedIn(I.Z.PRIVATE),n=this.get("advancedCopyFlowVisible")&&this.model.canResetPermissions(),r=!this.model.shouldEnforcePermissionInheritance(this.model.get("type"));this.set("restorePermsVisible",!t&&!o&&(r||n))},updateFolderOptionsVisibility:function(){var e,t,o=(0,G.Gd)({targetPhase:$.t.PHASE_2}),n=this.model.get("type"),r=this.get("advancedCopyFlowVisible"),i=this.model.areAnyFolders(),a=null===(e=this.model.selectedFolder)||void 0===e||null===(t=e.get)||void 0===t?void 0:t.call(e,"path"),s=I.Z.getPrivateForUser(K.Z.getShortName()).get("path"),l=o&&(!n||r)&&i&&!!a&&a!==I.Z.PRIVATE&&a!==I.Z.SHARED&&a!==s;this.set("folderOptionsVisible",l)},getAdvancedButtonTitle:function(){return this.get("advancedCopyFlowVisible")?"copy"===this.model.get("type")?this.get("backToCopy"):this.get("backToMoveCopy"):this.get("advancedFolderCopy")},updateAdvancedCopyButton:function(){var e=this.getAdvancedButtonTitle();return this.set("advancedCopyButtonTitle",e),e},showAdvancedCopyButton:function(){this.set("advancedCopyButtonVisible",!0),this.updateAdvancedCopyButton()},getCopyMoveButtonTooltipMessage:function(e){var t=[{key:"targetIsNotUnderSource",message:this.get("cantCopyToSubfolder")},{key:"sourceAndTargetDifferent",message:this.get("sourceCantBeTarget")},{key:"hasPermissions",message:this.get("noPermissionsToWrite")},{key:"noFilesAllowedUnderShared",message:this.get("cantAddFilesToFolder")}],o=p().find(t,(function(t){return!e[t.key]}));return o&&o.message},toggleAdvancedCopyFlowVisibility:function(e){var t="advancedCopyFlowVisible",o=p().isUndefined(e)?!this.get(t):e;return this.set(t,o),this.updateAdvancedCopyButton(),this.updateTitle(),o},isAdvancedCopyFlowVisible:function(){return this.get("advancedCopyFlowVisible")},updateTitle:function(){var e=this.buildTitle();return this.set("title",e),e},setCreateFolderDisabled:function(e){this.set("createFolderDisabled",e)},buildTitle:function(){var e=this.model,t=this.model.toJSON(),o="copyMove.content.title";if("GDrive"===e.get("source"))return(0,d.t)("".concat(o,"GDriveCopy"),{count:t.fileList.length});var n=t.fileCount>1,r=e.get("showCopy"),i=e.get("showMove"),a=!!e.items.findWhere({type:Y.dt.FOLDER}),s=!!e.items.findWhere({type:Y.dt.FILE}),l=function(){return(0,d.t)(o,{name:(0,U.q)(this.get("name")),fileCount:t.fileCount})}.bind(this);return this.isAdvancedCopyFlowVisible()?(o+="AdvancedCopy",l()):(i&&(o+="Move"),r&&(o+="Copy"),o+=n?"Multiple":"Single",n&&s&&(o+="Files"),n&&a&&(o+="Folders"),l())}}),X=q,J=o(780512),Q=o(693144).Z.extend({defaults:{defaultOption:null,options:[],disabled:!1}}),ee=Q.extend({defaults:{label:"copyMove.advanced.permissions"},initialize:function(e,t){this.params=t,this.updateOptionsSet()},createOptionSet:function(){var e=ee.OPTION_SET,t=e.KEEP,o=e.INHERIT,n=e.RESET,r=[],i=this.params,a=i.copyMoveModel,s=i.advancedCopy,l=i.type;return"copy"===l&&this.set("label","copyMove.advanced.permissionsForCopy"),"move"===l&&this.set("label","copyMove.advanced.permissionsForMove"),a.shouldEnforcePermissionInheritance(l)?r.push(o):r.push(t,o),s&&a.canResetPermissions()&&r.push(n),r},updateOptionsSet:function(){this.set("options",this.createOptionSet())}},{OPTION_SET:{KEEP:{value:F.Z.RESTORE_PERMISSIONS.KEEP,label:"copyMove.advanced.keepPerms"},INHERIT:{value:F.Z.RESTORE_PERMISSIONS.INHERIT,label:"copyMove.advanced.inheritPerms"},RESET:{value:F.Z.RESTORE_PERMISSIONS.RESET,label:"copyMove.advanced.setupNewPerms"}}});function te(e){var t=e,o=t.copyMoveModel,n=t.type,r=o.constructor.RESTORE_PERMISSIONS,i=o.isOriginalPermissionKeptByDefault(n)?r.KEEP:r.INHERIT;function a(){e.onChange(d.get("value"))}e=p().defaults(e||{},{onChange:R().noop,defaultOption:o.getRestorePermissionsMethod()||i,advancedCopy:!1});var s,l,d=new ee({defaultOption:e.defaultOption,value:e.defaultOption},e);return d.on("change:value",a),a(),s=d,(l=new J.Z.Bridge({model:s})).once("close",(function(){s.off("change:value")})),l.listenTo(l,"destinationUpdated",(function(){s.updateOptionsSet()})),l}var oe=Q.extend({initialize:function(e,t){this.params=t,Q.prototype.initialize.call(this,e,t),this.set("options",this.createOptionSet())},createOptionSet:function(){var e=oe.OPTION_SET,t=e.KEEP_SOURCE,o=e.APPLY_DESTINATION;return this.set("label","copyMove.folderOptions.label"),[t,o]}},{OPTION_SET:{KEEP_SOURCE:{value:F.Z.FOLDER_OPTIONS_MODE.KEEP_SOURCE,label:"copyMove.folderOptions.keepSource"},APPLY_DESTINATION:{value:F.Z.FOLDER_OPTIONS_MODE.APPLY_DESTINATION,label:"copyMove.folderOptions.applyDestination"}}});function ne(e){function t(){e.onChange(r.get("value"))}e=p().defaults(e||{},{onChange:R().noop,defaultOption:F.Z.FOLDER_OPTIONS_MODE.APPLY_DESTINATION});var o,n,r=new oe({defaultOption:e.defaultOption,value:e.defaultOption},e);return r.on("change:value",t),t(),o=r,(n=new J.Z.Bridge({model:o})).once("close",(function(){o.off("change:value")})),n}var re=o(621395),ie=o(984440),ae=o(13764),se=o(476013),le=o(712744),de=o(215671),ce=o(143144),ue=o(360136),pe=o(182963),me=o(661120),ve=o(366350),he=o(439801);var fe=function(e){(0,ue.Z)(r,e);var t,o,n=(t=r,o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,n=(0,me.Z)(t);if(o){var r=(0,me.Z)(this).constructor;e=Reflect.construct(n,arguments,r)}else e=n.apply(this,arguments);return(0,pe.Z)(this,e)});function r(){return(0,de.Z)(this,r),n.apply(this,arguments)}return(0,ce.Z)(r,[{key:"render",value:function(){return S.createElement("div",{className:"advanced-copy form"},S.createElement(he.Z,{model:this.props.formModel.inputs.name}),S.createElement(he.Z,{className:"description",model:this.props.formModel.inputs.folderDescription,type:he.Z.TYPE.TEXTAREA}))}}]),r}(S.Component);fe.Bridge=ve.Z.extend({initializeComponent:function(e){return S.createElement(fe,e)},onShow:function(){this.$el.find(".name input").focus()}});var ye=fe,be=le.Z.extend({build:function(){this.addInput(new se.Z({label:(0,d.t)("copyMove.content.folderName"),name:"name",autoSelect:!0})),this.addInput(new se.Z({label:(0,d.t)("copyMove.advanced.description"),name:"folderDescription"}))},updateDescription:function(e){var t=e.get("permission"),o=(0,ae.Jg)(t);return this.inputs.folderDescription.set({value:o?this.inputs.folderDescription.get("value"):"",disabled:!o,placeholder:o?(0,d.t)("copyMove.advanced.descriptionPlaceholder"):"",tooltip:o?"":(0,d.t)("copyMove.advanced.cantModifyNoPerms")}),o}}),ge=function(e){return function(t){!function(e){var t=e.items.first();e.set({name:e.get("folderName")||(0,d.t)("copyMove.advanced.folderCopy",{name:t.get("name")}),folderDescription:e.get("folderDescription")||""})}(e);var o=function(e,t){var o=new be(void 0,{model:e});return o.listenTo(o,"reForm:errorsCleared",(function(e){e||t.onErrorsCleared()})),o}(e,t);return function(e,t){var o=new ye.Bridge({formModel:e});return o.listenTo(o,"show",(function(){e.updateDescription(t.selectedFolder)})),o.listenTo(o,"close",(function(){e.unbind()})),o.listenTo(o,"destinationUpdated",(function(t){e.updateDescription(t)})),o}(o,e)}};function Oe(e){var t=(0,a.Jo)();return function(o,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},l=a.documentRoomId,d=void 0===l?null:l,c=a.workspaceId,u=void 0===c?null:c;if(o.length){var p=a.operationItem||new F.Z({type:e,folderName:a.folderName,folderDescription:a.folderDescription},{sourceFolder:d||u?null:r,items:o,endpoint:i.Z.FILE_SYSTEM_OPERATIONS.ROOT,documentRoomId:d,workspaceId:u});a.restorePermissions&&p.setRestorePermissionsMethod(a.restorePermissions);var m,v=a.prevalidationModel||new ie.Z(null,{copyMoveModel:p}),h=new X({showDndNotice:a.showDndNotice},{model:p}),f=P.Z.create({model:p,prevalidationModel:v,prevalidationStatusModalFactory:re.Z,overwriteDialogFactory:C.Z,asyncCopyMoveExplanatoryDialogFactory:s.Z}),y=new w({model:p,controller:f,newFolderFormFactory:T,treeFactory:j,restorePermissionsFactory:te,folderOptionsFactory:ne,advancedCopyFactory:ge(p),viewModel:h,advancedMode:t.features.advancedCopyMove,documentRoomId:d,workspaceId:u,onHide:function(){m.modal("hide")}});p.on("advancedCopySuccess",(function(e){f.shouldShowFolderPermissions()&&n.Z.once("close",(function(){f.showFolderPermissions(e)}))})),m=n.Z.create(y,{onShown:function(){y.trigger("modalShown"),a.advancedCopyFlow&&y.showAdvancedCopyFlow(),a.destination&&y.setDestination(a.destination)}})}}}function Ee(){return Oe()}function we(){return Oe(r.Z.OperationItem.COPY)}function Fe(){return Oe(r.Z.OperationItem.MOVE)}},239997:function(e,t,o){"use strict";o.d(t,{t:function(){return bt}});var n=o(115861),r=o(529439),i=o(204942),a=o(364687),s=o.n(a),l=o(667294),d=o(403455),c=o(154177),u=o(141797),p=o(579621),m=o(698607),v=o(610861),h=o(823592),f=o(762074),y=o(531926),b=o(722332),g=o(787781),O=o(22154),E=o(397404),w=o(193645),F=o(318450),P=o(145987),C=o(23661),I=o(240701),M=o(599417),T=o(914312),_=o(725117),Z=["destinationFolderId","documentRoomId","workspaceId"],S=["destinationFolderId","documentRoomId","workspaceId"],A=["destinationFolderId","documentRoomId","workspaceId"];function R(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function D(e){var t=e.destinationFolderId,o=e.documentRoomId,n=e.workspaceId;return o?I.Z.DOCUMENT_ROOM.PORTAL.CONTENTS_ITEM({documentRoomId:o,id:t}):n?I.Z.CLIENT_PORTAL.WORKSPACES.FSI.ITEM_CONTENTS({workspaceId:n,itemId:t}):I.Z.FSI.CONTENTS(t)}function N(e){var t=e.destinationFolderId,o=e.documentRoomId,n=e.workspaceId,r=(0,P.Z)(e,Z),i=D({destinationFolderId:t,documentRoomId:o,workspaceId:n});return(0,C.ZP)(i,{method:C.I5.POST,body:r,headers:{"Content-Type":_.Id.COPY_MOVE}})}function B(e){var t=e.destinationFolderId,o=e.documentRoomId,n=e.workspaceId,r=(0,P.Z)(e,S),i=D({destinationFolderId:t,documentRoomId:o,workspaceId:n});return(0,C.ZP)(i,{method:C.I5.POST,body:r,headers:{"Content-Type":_.Id.PREVALIDATE}})}function k(e){var t=e.destinationFolderId,o=e.documentRoomId,n=e.workspaceId,r=(0,P.Z)(e,A),a=(0,M.Gd)({targetPhase:T.t.PHASE_2}),s=function(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?R(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):R(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}({_method:r._method,path:r.path,destinationPath:r.destinationPath,name:r.name,folderDescription:r.folderDescription,permissions:r.permissions,overwrite:r.overwrite},a&&r.folderOptionsMode?{folderOptionsMode:r.folderOptionsMode}:{}),l=D({destinationFolderId:t,documentRoomId:o,workspaceId:n});return(0,C.ZP)(l,{method:C.I5.POST,body:s,headers:{"Content-Type":_.Id.ADVANCED_COPY}})}function V(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function L(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?V(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):V(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var x=o(346734),j=o(839470),H=o(153672),W=o(487462),U=o(625735),Y=o(526594),z=o(881575),K=o(737639),G=o(638859),$=(0,f.nD)("copyMove.prevalidation");function q(e){var t=e.operation,o=e.failedItems,i=e.onContinue,a=e.onCancel,d=(0,l.useState)(!1),c=(0,r.Z)(d,2),u=c[0],p=c[1],m=(0,G.Z)(),h=(0,Y.j)(o),y=h.errors,b=h.warnings,g=(0,f.t)("storage.actions.".concat(t)),O=$("error.".concat(t,".title")),E={title:$("warning.title"),conflictStatusLabel:$("warning.status"),conflictTitle:$("warning.conflict")};function w(){return(w=(0,n.Z)(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p(!0),e.prev=1,!((t=null==i?void 0:i())instanceof Promise)){e.next=6;break}return e.next=6,t;case 6:m()&&p(!1),e.next=13;break;case 9:throw e.prev=9,e.t0=e.catch(1),m()&&p(!1),e.t0;case 13:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}return l.createElement(U.Z,{title:g},l.createElement(U.Z.Body,null,!!y&&l.createElement(K.Z,{title:O,messages:y}),!!b&&l.createElement(z.Z,(0,W.default)({},E,{messages:b}))),l.createElement(U.Z.Footer,null,l.createElement(U.Z.CancelButton,{onClick:function(){(0,v.GZ)(),null==a||a()}}),!!b&&l.createElement(U.Z.ContinueButton,{isLoading:u,onClick:function(){return w.apply(this,arguments)}})))}function X(e){(0,v.Ll)(l.createElement(q,e),{size:v.ZP.sizes.L})}var J=o(13764),Q=o(323063),ee=o(601714),te=o(63661),oe=(0,f.nD)("copyMove.contentV2"),ne="KEEP_ORIGINAL",re="INHERIT_FROM_PARENT",ie="RESET",ae="APPLY_DESTINATION",se=[{value:ne,label:oe("permissions.keepPerms")},{value:re,label:oe("permissions.inheritPerms")},{value:ie,label:oe("permissions.setupNewPerms"),description:oe("permissions.setupNewPermsDescription")}],le=[{value:"KEEP_SOURCE",label:oe("folderOptions.keepSource")},{value:ae,label:oe("folderOptions.applyDestination")}],de="copy",ce="move",ue=(0,f.nD)("copyMove");function pe(e){return e===de?_.ug.COPY:_.ug.MOVE}function me(e){switch(e){case te.P_.KEEP:return ne;case te.P_.INHERIT:case te.P_.ENFORCE_INHERITANCE:default:return re}}function ve(e,t,o){var n=t.length;return 1===n?ue("success.notification.".concat(e,"ItemIntoSuccess"),{name:t[0].name,targetFolder:o.name}):ue("success.notification.".concat(e,"ItemIntoSuccess_plural"),{count:n,targetFolder:o.name})}function he(e){return ue("error.".concat(e,"Error"))}function fe(e){return 1===e.length&&e[0].type===Q.dt.FOLDER}function ye(e){return e.some((function(e){return e.type===Q.dt.FOLDER}))}function be(e,t){return ye(e)&&t===de}function ge(e){var t=e.destinationPath;return!!t&&t!==b.Z.PRIVATE&&t!==b.Z.SHARED&&!t.startsWith(b.Z.PRIVATE)}function Oe(e){var t=e.destinationPath;return!!(0,M.Gd)({targetPhase:T.t.PHASE_2})&&!!t&&t!==b.Z.PRIVATE&&t!==b.Z.SHARED&&t!==b.Z.getPrivateForUser(ee.Z.getShortName()).get("path")}var Ee=o(735691),we=o(828075),Fe=o(799532),Pe=o(531081),Ce=o(809981),Ie=(0,f.nD)("button.label");function Me(e){var t=e.selectedOperation,o=e.onOperationChange;return l.createElement(we.Z,{selectedValue:t,onChange:function(e){return o(e)},fullWidth:!0},l.createElement(we.Z.Action,{icon:l.createElement(Fe.Z,{icon:Pe.KF}),value:ce},Ie("move")),l.createElement(we.Z.Action,{icon:l.createElement(Fe.Z,{icon:Ce.O}),value:de},Ie("copy")))}var Te=o(40509),_e=o(513580),Ze=o(107831),Se=o(255725),Ae=o(232452),Re=(0,f.nD)("copyMove.contentV2");function De(e){var t,o=e.sourceFolder,n=e.documentRoomId,r=e.workspaceId,i=e.treeKey,a=(0,G.Z)(),s=!(!n&&!r),d=(0,l.useMemo)((function(){return(0,O.DW)(o)}),[o]),c=(0,l.useMemo)((function(){return(0,O.$l)(d)}),[d]),u=(0,Se.Z)({path:c,id:null!==(t=n||r)&&void 0!==t?t:"",documentRoomId:null!=n?n:void 0,workspaceId:null!=r?r:void 0,customAdapter:s?Ae.Z:void 0});return l.createElement("div",{className:"KBffrEqVMWlkZe9o_bfA"},l.createElement(Te.Z.Paragraph,null,l.createElement(Te.Z.SemiBold,null,Re("targetFolder"))),l.createElement("div",{className:"ED27SZCSL3otuwxYQMtL"},l.createElement("div",{className:"Q7ToXTkNbgLoVZz2fnzq","data-tid":"folder-tree-container"},l.createElement(_e.Z,{key:i,name:"targetFolder",className:"D18jhemvfw4xxsqzImdZ",fieldProps:{label:"","aria-label":Re("selectTargetFolder")},getTreeProps:function(e){var t,o=e.field,n=e.fieldHelpers;return{mode:_e.Z.MODES.SINGLESELECT,path:(null===(t=o.value)||void 0===t?void 0:t.path)||d,includePrivateFolders:!0,customAdapter:s?Ae.Z:void 0,TreeControllerComponent:s?u:void 0,onFolderSelect:function(e){n.setValue(e)},onInitialFolderData:function(e){a()&&n.setValue(e)}}}})),l.createElement("div",{className:"_qDYWP80NDHqq7Oafiv9"},l.createElement(Ze.Z,{name:"targetFolder"}))))}var Ne=o(681123),Be=o(983815),ke=o(289098),Ve=o(677757),Le=o(79564),xe=(0,f.nD)("copyMove.contentV2");function je(e,t){var o=e.find((function(e){return e.value===t}));return(null==o?void 0:o.label)||""}function He(e){var t=e.values,o=e.permissionsOptions,n=e.folderOptions,r=[],i=je(o,t.permissions);i&&r.push(i);var a=je(n,t.folderOptions);return a&&r.push(a),r.length?l.createElement(Le.Z,{size:Fe.Z.sizes.M},l.createElement("span",null,xe("advanced.currentlySelectedProperties")),l.createElement("ul",{className:"mr4SETIAir4cSFaBo1HO"},r.map((function(e){return l.createElement("li",{key:e},e)})))):null}var We=(0,f.nD)("copyMove.contentV2"),Ue="advanced-copy-properties";function Ye(e){var t=e.canChangeFolderOptions,o=e.canChangeNameAndDescription,n=void 0===o||o,a=(0,d.u6)().values,s=a.targetFolder,c=(0,l.useState)((0,i.Z)({},Ue,!1)),u=(0,r.Z)(c,2),p=u[0],m=u[1],v=(0,H.Lb)("workgroup.defaultPermissionsModeForCopy"),h=(0,r.Z)(v.data,1)[0],f=null==s?void 0:s.path,y=(0,l.useMemo)((function(){return h===Ve.Z.ENFORCE_INHERITANCE}),[h]),b=(0,l.useMemo)((function(){return!(null==s||!s.permission)&&(0,J.mF)(s.permission)}),[s]),g=(0,l.useMemo)((function(){return ge({destinationPath:f,shouldEnforcePermissionInheritance:y,canResetPermissions:b})}),[f,y,b]),O=(0,l.useMemo)((function(){return Oe({destinationPath:f})}),[f]),E=(0,l.useMemo)((function(){return function(e,t){var o=(0,r.Z)(se,3),n=o[0],i=o[1],a=o[2],s=[];return e?s.push(i):s.push(n,i),t&&s.push(a),s}(y,b)}),[y,b]);return g||O||n?l.createElement("div",{className:"vcFUB_MbxIm8EGgV_fh0"},l.createElement(Ne.Z,{expanded:p,onChange:function(e){return m(e)},variant:Be.f.BORDERLESS},l.createElement(Ne.Z.Panel,{name:Ue},l.createElement(Ne.Z.Heading,null,l.createElement("div",{className:"MwoL74IeIHQIPdLwWRsX"},l.createElement(Ne.Z.ToggleIcon,null),We("advanced.advancedFolderCopy"),!p[Ue]&&l.createElement(He,{values:a,permissionsOptions:se,folderOptions:le}))),l.createElement(Ne.Z.Body,null,l.createElement("div",{className:"eT48kKu_hdERRcQZfP9L"},n&&l.createElement(l.Fragment,null,l.createElement(ke.Text,{name:"name",label:We("folderName"),placeholder:We("folderName"),width:ke.Text.WIDTH.AUTO}),l.createElement(ke.Textarea,{name:"folderDescription",label:We("advanced.description"),placeholder:We("advanced.descriptionPlaceholder"),width:ke.Textarea.WIDTH.AUTO,rows:3,maxLength:200})),g&&l.createElement(ke.Select,{name:"permissions",label:We("permissions.permissions"),infoTooltip:We("permissions.permissionsTooltip"),options:E,width:ke.Select.WIDTH.AUTO}),O&&l.createElement(ke.Select,{name:"folderOptions",label:We("folderOptions.label"),infoTooltip:We(t?"folderOptions.tooltip":"folderOptions.noPermissionsTooltip"),options:le,width:ke.Select.WIDTH.AUTO,disabled:!t})))))):null}var ze=(0,f.nD)("copyMove.contentV2"),Ke=[{value:"KEEP_ORIGINAL",label:ze("permissions.keepPerms")},{value:"INHERIT_FROM_PARENT",label:ze("permissions.inheritPerms")}],Ge=[{value:"KEEP_SOURCE",label:ze("folderOptions.keepSource")},{value:"APPLY_DESTINATION",label:ze("folderOptions.applyDestination")}],$e=(0,f.nD)("copyMove.contentV2"),qe="advanced-move-properties";function Xe(e){var t=e.canChangeFolderOptions,o=(0,l.useState)((0,i.Z)({},qe,!1)),n=(0,r.Z)(o,2),a=n[0],s=n[1],c=(0,d.u6)(),u=c.values,p=c.values.targetFolder,m=(0,H.Lb)("workgroup.defaultPermissionsModeForMove"),v=(0,r.Z)(m.data,1)[0],h=null==p?void 0:p.path,f=(0,l.useMemo)((function(){return v===Ve.Z.ENFORCE_INHERITANCE}),[v]),y=(0,l.useMemo)((function(){return ge({destinationPath:h,shouldEnforcePermissionInheritance:f})}),[h,f]),b=(0,l.useMemo)((function(){return Oe({destinationPath:h})}),[h]),g=(0,l.useMemo)((function(){return function(e){var t=(0,r.Z)(Ke,2),o=t[0],n=t[1];return e?[n]:[o,n]}(f)}),[f]);return y||b?l.createElement("div",{className:"cWlX7F0qEieKBG6A9ZHI"},l.createElement(Ne.Z,{expanded:a,onChange:function(e){return s(e)},variant:Be.f.BORDERLESS},l.createElement(Ne.Z.Panel,{name:qe},l.createElement(Ne.Z.Heading,null,l.createElement("div",{className:"fRPGM7VVlDIMF4yOncdv"},l.createElement(Ne.Z.ToggleIcon,null),$e("advanced.advancedFolderMove"),!a["advanced-move-properties"]&&l.createElement(He,{values:u,permissionsOptions:Ke,folderOptions:Ge}))),l.createElement(Ne.Z.Body,null,l.createElement("div",{className:"xXm1aUSULYbib37RNzkg"},y&&l.createElement(ke.Select,{name:"permissions",label:$e("permissions.permissions"),infoTooltip:$e("permissions.permissionsTooltipForMove"),options:g,width:ke.Select.WIDTH.AUTO}),b&&l.createElement(ke.Select,{name:"folderOptions",label:$e("folderOptions.label"),infoTooltip:$e(t?"folderOptions.tooltip":"folderOptions.noPermissionsTooltip"),options:Ge,width:ke.Select.WIDTH.AUTO,disabled:!t})))))):null}var Je=o(460474),Qe=o(534733),et=o(943439);function tt(e){var t=e.targetFolder,o=e.itemsArray,n=e.selectedOperation,i=function(e){var t=(0,Je.Z)("folderOptionsAdvanceManagementEnabled"),o=(0,H.Lb)("{ workgroup.folderOptionManagementType, user.typeName }"),n=(0,r.Z)(o.data,2),i=n[0],a=n[1];return(0,l.useMemo)((function(){if(null==e||!e.permission)return!1;var o=(0,J.mF)(e.permission),n=a===Qe.$A.STANDARD,r=a===Qe.$A.ADMIN,s=o&&!n;return t&&i===et.In.ADMINS_ONLY?r:s}),[e,t,i,a])}(t),a=(0,l.useMemo)((function(){return be(o,n)}),[o,n]),s=(0,l.useMemo)((function(){return function(e,t){return ye(e)&&t===ce}(o,n)}),[o,n]),d=(0,l.useMemo)((function(){return fe(o)}),[o]);return l.createElement(l.Fragment,null,a&&l.createElement(Ye,{canChangeNameAndDescription:d,canChangeFolderOptions:i}),s&&l.createElement(Xe,{canChangeFolderOptions:i}))}var ot=o(42594);function nt(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function rt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?nt(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):nt(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function it(e){var t=e.values,o=e.itemsArray,n=e.selectedOperation,r=e.overwrite,i=void 0!==r&&r,a=e.documentRoomId,s=e.workspaceId,l=t.targetFolder;if(!l)throw new Error("targetFolder is required");var d=(0,M.Gd)({targetPhase:T.t.PHASE_2}),c=o.map((function(e){var o={path:(0,ot.DW)(e)};return e.type===Q.dt.FOLDER&&(t.permissions&&(o.permissions=t.permissions),d&&t.folderOptions&&(o.folderOptionsMode=t.folderOptions)),o}));return rt(rt({destinationFolderId:l.id,_method:pe(n),destinationPath:(0,ot.DW)(l),resources:c,overwrite:i},a?{documentRoomId:a}:{}),s?{workspaceId:s}:{})}function at(e){var t=e.values,o=e.itemsArray,n=e.selectedOperation,r=e.overwrite,i=void 0!==r&&r,a=e.documentRoomId,s=e.workspaceId,l=t.targetFolder;if(!l)throw new Error("targetFolder is required");var d=(0,M.Gd)({targetPhase:T.t.PHASE_2}),c=o[0],u=rt(rt({destinationFolderId:l.id,_method:pe(n),path:(0,ot.DW)(c),destinationPath:(0,ot.DW)(l),name:t.name,folderDescription:t.folderDescription||null,permissions:t.permissions||ne,overwrite:i},a?{documentRoomId:a}:{}),s?{workspaceId:s}:{});return d&&t.folderOptions&&(u.folderOptionsMode=t.folderOptions),u}var st=o(776327),lt=o(723756),dt=o(956729),ct=o(982925);function ut(e){var t=e.itemsArray,o=e.selectedOperation,n=e.targetFolder,r=e.invalidateFolder,i=e.invalidateFolderTree;st.ZP.trigger(st.ZP.Events.Operation.COPYMOVE.TREE_UPDATE,{itemsArray:t,selectedOperation:o,targetFolder:n}),null==r||r(),null==i||i(n.path)}function pt(e,t){var o,n,r=t.values,i=t.selectedOperation,a=t.itemsArray,s=t.documentRoomId,l=t.invalidateFolder,d=t.invalidateFolderTree;if(function(e){return!("errors"in e)}(e)){(0,v.Mr)();var c=r.targetFolder;if(!c)throw new Error("Destination folder must be selected");return(0,E.c0)("success",ve(i,a,c)),(0,dt.BT)(),a.forEach((function(e){return(0,ct.UR)(e.id)})),ut({itemsArray:a,selectedOperation:i,targetFolder:c,invalidateFolder:l,invalidateFolderTree:d}),void(function(e,t){return e===de&&t.permissions===ie&&null!==t.targetFolder&&(0,J.mF)(t.targetFolder.permission)}(i,r)&&e.id&&e.path&&(st.ZP.trigger(st.ZP.Events.Storage.PATH.UPDATE,{path:(0,ot.DW)(e)}),setTimeout((function(){!function(e){var t=e.path,o=e.name,n=e.id,r=e.documentRoomId;(0,lt.Z)({path:t,name:o,id:n,isModificationAllowed:!0,documentRoomId:r||null})}({path:(0,ot.DW)(e),name:e.name||r.name,id:e.id,documentRoomId:s})}),0)))}(0,v.Mr)(),(0,E.c0)("error",(null===(o=e.errors)||void 0===o||null===(n=o[0])||void 0===n?void 0:n.msg)||he(i))}function mt(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function vt(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?mt(Object(o),!0).forEach((function(t){(0,i.Z)(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):mt(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}var ht=(0,f.nD)("button.label");function ft(e){var t=vt({},e);return e.destinationPath&&(t.targetFolder=e.destinationPath,delete t.destinationPath),t}function yt(e){var t=e.itemsCollection,o=e.sourceFolder,i=e.params,a=(0,l.useState)(ce),P=(0,r.Z)(a,2),C=P[0],I=P[1],M=(0,l.useState)((function(){return(0,j.Z)()})),T=(0,r.Z)(M,2),_=T[0],Z=T[1],S=(0,l.useRef)(null),A=(0,x.q)(),R=(0,x.i)(),D=(0,h.xH)(t.models),V=function(e){if(0===e.length)return"";if(1===e.length){var t=e[0].name;return ue("contentV2.title.singleItem",{name:t})}var o=e.filter((function(e){return e.type===Q.dt.FOLDER})).length,n=e.filter((function(e){return e.type===Q.dt.FILE})).length;return o>0&&0===n?ue("contentV2.title.multipleFolders",{count:o}):n>0&&0===o?ue("contentV2.title.multipleFiles",{count:n}):ue("contentV2.title.multipleItems",{count:e.length})}(D),W=i||{},U=W.documentRoomId,Y=W.workspaceId,z=(0,H.Lb)("workgroup.{defaultPermissionsModeForCopy,defaultPermissionsModeForMove}"),K=(0,r.Z)(z.data,2),G=K[0],$=K[1],q=(0,l.useCallback)((function(e){return e===de?G:$}),[G,$]),ee=(0,l.useMemo)((function(){return be(D,C)}),[D,C]),te=(0,l.useMemo)((function(){var e=t.models[0];return o||e.parentFolder||new b.Z({path:g.ZP.getParentPath((0,O.DW)(e))})}),[o,t.models]),oe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,F.useMutation)(L({mutationFn:B},e))}({onError:function(e){(0,E.c0)("error",e.message)}}),ne=oe.mutateAsync,re=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,F.useMutation)(L({mutationFn:N},e))}({onError:function(e){(0,E.c0)("error",e.message)}}),se=re.mutateAsync,le=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,F.useMutation)(L({mutationFn:k},e))}(),pe=le.mutateAsync,ye=function(e){I(e);var t=me(q(e));S.current&&S.current.setFieldValue("permissions",t)},ge=(0,l.useMemo)((function(){if(null==i||!i.destination)return null;var e=w.Z.toRawNode(i.destination);return e?vt(vt({},e),{},{indentLevel:0}):null}),[null==i?void 0:i.destination]),Oe=(0,l.useMemo)((function(){var e;return{targetFolder:ge,name:fe(D)?(0,f.t)("copyMove.contentV2.advanced.folderCopy",{name:(null===(e=D[0])||void 0===e?void 0:e.name)||""}):"",folderDescription:"",permissions:me(q(ce)),folderOptions:ae,overwrite:!1}}),[ge,D,q]),we=function(){var e=(0,n.Z)(s().mark((function e(t){var o,n,r,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.values,n=t.overwrite,r=it({values:o,itemsArray:D,selectedOperation:C,overwrite:n,documentRoomId:U,workspaceId:Y}),e.next=4,se(r);case 4:i=e.sent,Fe({values:o,data:i});case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Fe=function(e){var t,o=e.values,n=e.data,r=(null==n||null===(t=n.results)||void 0===t?void 0:t.filter((function(e){return e.status>=300})))||[];0!==r.length?r.some((function(e){return 409===e.status||412===e.status}))?X({operation:C,failedItems:r,onContinue:function(){return we({values:o,overwrite:!0})},onCancel:function(){return Z((0,j.Z)())}}):((0,v.Mr)(),(0,E.c0)("error",he(C))):function(e){var t=e.values,o=e.selectedOperation,n=e.itemsArray,r=e.invalidateFolder;(0,v.Mr)();var i=t.targetFolder;if(!i)throw new Error("targetFolder should be validated before calling handler");(0,E.c0)("success",ve(o,n,i)),(0,dt.BT)(),n.forEach((function(e){return(0,ct.UR)(e.id)})),ut({itemsArray:n,selectedOperation:o,targetFolder:i,invalidateFolder:r})}({values:o,selectedOperation:C,itemsArray:D,documentRoomId:U,invalidateFolder:A,invalidateFolderTree:R})},Pe=function(e){var t=e.values,o=e.data.results.filter((function(e){return e.status>=300}));0!==o.length?X({operation:C,failedItems:o,onContinue:function(){return we({values:t,overwrite:!0})},onCancel:function(){return Z((0,j.Z)())}}):we({values:t,overwrite:t.overwrite})},Ce=function(){var e=(0,n.Z)(s().mark((function e(t,o){var n,r,i,a,l,d,u,p,m,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=o.setErrors,r=o.setSubmitting,t.targetFolder){e.next=3;break}return e.abrupt("return");case 3:if(i=t.name||t.folderDescription||t.permissions===ie,a=ee&&!i,l={values:t,selectedOperation:C,itemsArray:D,documentRoomId:U,invalidateFolder:A,invalidateFolderTree:R},!ee||!i){e.next=21;break}return d=at({values:t,itemsArray:D,selectedOperation:C,overwrite:t.overwrite,documentRoomId:U,workspaceId:Y}),e.prev=9,e.next=12,pe(d);case 12:pt(e.sent,l),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(9),(0,c.k0)(e.t0)?(u=(0,c.lt)(e.t0))?n(ft(u)):(0,E.c0)("error",(0,c.e$)(e.t0)):(0,E.c0)("error",he(C));case 19:return r(!1),e.abrupt("return");case 21:if(!a){e.next=35;break}return p=it({values:t,itemsArray:D,selectedOperation:C,overwrite:t.overwrite,documentRoomId:U,workspaceId:Y}),e.prev=23,e.next=26,ne(p);case 26:m=e.sent,Pe({values:t,data:m}),e.next=33;break;case 30:e.prev=30,e.t1=e.catch(23),(0,E.c0)("error",he(C));case 33:return r(!1),e.abrupt("return");case 35:return e.prev=35,e.next=38,we({values:t,overwrite:t.overwrite});case 38:e.next=43;break;case 40:e.prev=40,e.t2=e.catch(35),(0,c.k0)(e.t2)?(v=(0,c.lt)(e.t2))?n(ft(v)):(0,E.c0)("error",(0,c.e$)(e.t2)):(0,E.c0)("error",he(C));case 43:r(!1);case 44:case"end":return e.stop()}}),e,null,[[9,16],[23,30],[35,40]])})));return function(t,o){return e.apply(this,arguments)}}();return l.createElement(l.Fragment,null,l.createElement(u.Z.Header,null,l.createElement(u.Z.Title,null,V)),l.createElement(d.J9,{innerRef:S,initialValues:Oe,validationSchema:Ee.Ry().shape({name:Ee.Z_().folderItemName(),folderDescription:Ee.Z_().max(200,(0,f.t)("copyMove.contentV2.validation.descriptionTooLong"))}),onSubmit:Ce},(function(e){var t=e.values,o=function(e){var t,o=e.targetFolder,n=e.sourceFolderPath,r=e.currentName,i=e.selectedOperation,a=e.isLockedFile,s=e.items,l=null==o?void 0:o.path,d=!!o,c=!!o&&(0,J.zm)(o.permission),u=((null===(t=s[0])||void 0===t?void 0:t.name)||"").trim(),p=(r||"").trim(),m=!!u&&!!p&&u.toLocaleLowerCase()!==p.toLocaleLowerCase(),v=d&&l===n,h=v&&m,f=s.some((function(e){var t;return e.type===Q.dt.FILE&&!0===(null===(t=e.lock)||void 0===t?void 0:t.isLocked)})),y=i===ce,g=y&&(null!=a?a:f),O=d&&!!l&&s.some((function(e){return l===e.path||l.startsWith("".concat(e.path,"/"))})),E=s.some((function(e){return e.path===b.Z.SHARED||e.path===b.Z.PRIVATE})),w=d&&l===b.Z.SHARED&&s.some((function(e){return e.type===Q.dt.FILE})),F="";return g?F=ue("error.lockedFilesDisabledMove"):O?F=ue(y?"error.cantMoveToSubfolder":"error.cantCopyToSubfolder"):v&&!h?F=ue("error.sourceCantBeTarget"):!c&&d?F=ue("error.noPermissionsToWrite"):w&&(F=ue("error.cantAddFilesToFolder")),{isSubmitDisabled:!d||E||g||O||v&&!h||!c||w,tooltip:F}}({items:D,targetFolder:t.targetFolder,sourceFolderPath:(0,O.DW)(te),currentName:t.name,selectedOperation:C}),n=o.isSubmitDisabled,r=o.tooltip;return l.createElement(d.l0,{id:"copy-move-form"},l.createElement(u.Z.Body,null,l.createElement(Me,{selectedOperation:C,onOperationChange:ye}),l.createElement(De,{treeKey:_,sourceFolder:te,documentRoomId:U,workspaceId:Y}),l.createElement(tt,{targetFolder:t.targetFolder,itemsArray:D,selectedOperation:C})),l.createElement(u.Z.Footer,null,l.createElement(p.Z,{onClick:v.Mr,type:p.Z.SECONDARY},ht("cancel")),l.createElement(m.Z,{tooltip:r,disabled:!n},l.createElement(y.Z,{disabled:n,idleText:ht(C)}))))})))}function bt(e){(0,v.h7)(l.createElement(yt,e),{onRequestClose:v.Mr,shouldCloseOnOverlayClick:!1,withCloseButton:!0,size:u.Z.sizes.XL})}},630140:function(e,t,o){"use strict";o.r(t);var n=o(830535);t.default={initializeCommonStorageFeatures:function(){this.initializeWebEdit()},deinitializeCommonStorageFeatures:function(){this.closeWebEdit()},initializeWebEdit:function(){this.webEdit=new n.Z},closeWebEdit:function(){this.webEdit.close(),this.webEdit=null}}},414111:function(e,t,o){"use strict";var n,r=o(204942),i=o(619755),a=o.n(i),s=o(19309),l=o(986456),d=o.n(l),c={PROCESSING:"processing",ERROR:"error",SUCCESS:"success",DEFAULT:"default"},u=s.Z.Marionette.ItemView.extend({currentState:"default",currentClass:"btn-primary",stateClasses:(n={},(0,r.Z)(n,c.PROCESSING,"btn-warning"),(0,r.Z)(n,c.ERROR,"btn-danger"),(0,r.Z)(n,c.SUCCESS,"btn-success"),(0,r.Z)(n,c.DEFAULT,"btn-primary"),n),update:function(e,t,o,n){o||(o=this.stateClasses[e]?this.stateClasses[e]:"btn-".concat(e)),this.stateClasses[e]||(this.stateClasses[e]=o),t=t||this.$el.data("text-".concat(e)),n&&(t='<i class="'.concat(n,'"></i>').concat(t)),this.$el.removeClass(this.currentClass).addClass(o).html(t),this.currentState=e,this.currentClass=o},initialize:function(e){this.stateClasses=d().clone(this.stateClasses),this.$el.hasClass(this.stateClasses.default)||(this.stateClasses.default=""),a().extend(!0,this,e),this.currentClass=this.stateClasses.default,this.listenTo(e.observe,e.trigger,this.update),this.$el.data("text-default",this.$el.html())}});u.STATE=c,t.Z=u},314990:function(module){module.exports=function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<aside\n    class="modal modal--md modal--copy-move fade"\n    data-bind-class-advanced="v.advancedCopyFlowVisible"\n    tabindex="-1"\n    role="dialog"\n>\n    <header class="modal__header">\n        <h3 data-bind-text="v.title" class="modal__title"></h3>\n    </header>\n    <div class="modal__body">\n        <div id="advanced-copy" data-bind-show="v.advancedCopyFlowVisible"></div>\n        <div\n            class="location-label left-label"\n            data-bind-show="v.advancedCopyFlowVisible"\n            data-bind-text="v.targetFolder"\n        ></div>\n        <p data-bind-hide="v.advancedCopyFlowVisible" data-bind-text="v.targetFolder"></p>\n        <div id="copy-move-tree"></div>\n        <div class="copy-move-toolbar">\n            <a class="action-create-folder" data-bind-class-disabled="v.createFolderDisabled">'+(null==(__t=createNewFolder)?"":__t)+"</a>\n            "+(null==(__t=createIn)?"":__t)+'\n            <span data-bind-text="m.selectedPath"></span>\n            <div id="copy-move-form"></div>\n        </div>\n        <div id="permissions-restore" data-bind-show="v.restorePermsVisible"></div>\n        <div id="permissions-restore-copy" data-bind-show="v.restorePermsVisible"></div>\n        <div id="permissions-restore-move" data-bind-show="v.restorePermsVisible"></div>\n        <div id="folder-options" data-bind-show="v.folderOptionsVisible"></div>\n    </div>\n    <footer class="modal__footer">\n        <div class="modal__actions">\n            <button\n                type="button"\n                id="advanced-copy-btn"\n                data-bind-show="v.advancedCopyButtonVisible"\n                data-bind-text="v.advancedCopyButtonTitle"\n                class="modal__action modal__action--tertiary"\n            ></button>\n            <button class="btn btn-secondary modal__action modal__action--secondary" type="button" data-dismiss="modal">\n                '+(null==(__t=cancelButton)?"":_.escape(__t))+'\n            </button>\n            <button\n                type="button"\n                class="btn btn-primary disabled disabled-move modal__action modal__action--primary"\n                data-bind-show="m.showDisabledMove"\n            >\n                '+(null==(__t=moveButton)?"":_.escape(__t))+'\n            </button>\n            <button\n                type="button"\n                class="btn btn-primary disabled action-move modal__action modal__action--primary"\n                data-bind-show="m.showMove"\n                data-bind-class-disabled="m.canMove | not"\n                data-bind-class-hide="v.advancedCopyFlowVisible"\n                data-text-processing="<i class=\'egi egi-refresh egi-spin\'></i> '+(null==(__t=moveInProgress)?"":_.escape(__t))+'"\n                data-text-success="'+(null==(__t=moveDone)?"":_.escape(__t))+'"\n                data-text-error="'+(null==(__t=moveError)?"":_.escape(__t))+'"\n            >\n                '+(null==(__t=moveButton)?"":_.escape(__t))+'\n            </button>\n            <button\n                type="button"\n                class="btn btn-primary disabled action-copy modal__action modal__action--primary"\n                data-bind-show="m.showCopy"\n                data-bind-class-disabled="m.canCopy | not"\n                data-text-processing="<i class=\'egi egi-refresh egi-spin\'></i> '+(null==(__t=copyInProgress)?"":_.escape(__t))+'"\n                data-text-success="'+(null==(__t=copyDone)?"":_.escape(__t))+'"\n                data-text-error="'+(null==(__t=copyError)?"":_.escape(__t))+'"\n            >\n                '+(null==(__t=copyButton)?"":_.escape(__t))+'\n            </button>\n        </div>\n    </footer>\n    <div data-bind-show="v.showDndNotice" class="dnd-notice">\n        <h3 class="dnd-notice__title">'+(null==(__t=t("copyMove.dndNotice.title"))?"":_.escape(__t))+'</h3>\n        <p class="dnd-notice__description" data-bind-html="v.dndNoticeText"></p>\n    </div>\n</aside>\n';return __p}}}]);