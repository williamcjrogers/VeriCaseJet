version: 1.0
runtime: python311
build:
  commands:
    build:
      - python3 -m pip install --upgrade pip
      - rm -rf pst-analysis-engine/api/vendor
      - python3 -m pip install --no-cache-dir -r pst-analysis-engine/api/requirements.txt -t pst-analysis-engine/api/vendor
run:
  runtime-version: 3.11
  command: python3 /app/pst-analysis-engine/api/app_runner_start.py
  network:
    port: 8010
    env: PORT
  env:
    - name: PYTHONUNBUFFERED
      value: "1"
    - name: USE_AWS_SERVICES
      value: "true"
    - name: AWS_STORAGE_BUCKET_NAME
      value: "vericase-docs-prod-526015377510"
    - name: S3_BUCKET
      value: "vericase-docs-prod-526015377510"
    - name: S3_BUCKET_NAME
      value: "vericase-docs-prod-526015377510"
    - name: AWS_S3_REGION_NAME
      value: "eu-west-2"
    - name: AWS_REGION
      value: "eu-west-2"
    - name: EMAIL_HOST
      value: "smtp.gmail.com"
    - name: EMAIL_PORT
      value: "587"
    - name: EMAIL_FROM
      value: "noreply@vericase.com"
    # Core settings
    - name: JWT_SECRET
      value: "vK9mP2xR7nQ4wL8jF6hD3sA5tY1uE0iO9pM7nB4vC2xZ8wQ6rT3yU5gH1kJ4fN"
    - name: DATABASE_URL
      value: "postgresql://postgres:r(6CwS%3aC9heN%7ce%5dYgxHOP%7c%23%23SK%23)@database-1.cv8uwu0uqr7f.eu-west-2.rds.amazonaws.com:5432/postgres?sslmode=require"
    # Admin account
    - name: ADMIN_EMAIL
      value: "admin@veri-case.com"
    - name: ADMIN_PASSWORD
      value: "Sunnyday8?!"
    # AWS credentials
    - name: AWS_ACCESS_KEY_ID
      value: "AKIAXU6HVVWBTCOQZZI3HX"
    - name: AWS_SECRET_ACCESS_KEY
      value: "7hT7ySs/GL+rl54vdbN3lnCtfgKb+vcouoJAkjH/"
    - name: S3_ACCESS_KEY
      value: "AKIAXU6HVVWBTCOQZZI3HX"
    - name: S3_SECRET_KEY
      value: "7hT7ySs/GL+rl54vdbN3lnCtfgKb+vcouoJAkjH/"
    - name: MINIO_BUCKET
      value: "vericase-docs-prod-526015377510"
    - name: REDIS_URL
      value: "redis://clustercfg.vericase-redis.dbbgbx.euw2.cache.amazonaws.com:6379/0"
    # OpenSearch configuration
    - name: OPENSEARCH_HOST
      value: "vpc-vericase-opensearch-sl2a3zd5dnrbt64bssyocnrofu.eu-west-2.es.amazonaws.com"
    - name: OPENSEARCH_PORT
      value: "443"
    - name: OPENSEARCH_USE_SSL
      value: "true"
    - name: OPENSEARCH_VERIFY_CERTS
      value: "true"
    - name: OPENSEARCH_USER
      value: "Admin"
    - name: OPENSEARCH_PASSWORD
      value: "Sunnyday8?!"
    - name: OPENSEARCH_INDEX
      value: "documents"
    # Apache Tika configuration
    - name: TIKA_URL
      value: "http://af1e5d629933d4867894d57ee814a68f-1641350390.eu-west-2.elb.amazonaws.com:9998"
    # Email credentials (optional - emails will fail silently if not configured)
    - name: EMAIL_HOST_USER
      value: "admin@veri-case.com"
    - name: EMAIL_HOST_PASSWORD
      value: "PLACEHOLDER"
    # AI API Keys (loaded from AWS Secrets Manager at runtime)
    - name: OPENAI_API_KEY
      value: ""  # Will be loaded from AWS Secrets Manager
    - name: ANTHROPIC_API_KEY
      value: ""  # Will be loaded from AWS Secrets Manager
    - name: GEMINI_API_KEY
      value: ""  # Will be loaded from AWS Secrets Manager
    - name: GROK_API_KEY
      value: ""  # Will be loaded from AWS Secrets Manager
    - name: PERPLEXITY_API_KEY
      value: ""  # Will be loaded from AWS Secrets Manager
    - name: AWS_SECRETS_MANAGER_AI_KEYS
      value: "vericase/ai-api-keys"  # Secret name in AWS Secrets Manager
