<div class="toolbar">
  <div class="toolbar-left">
    <!-- Search -->
    <div class="search-box">
      <i class="fas fa-search"></i>
      <label for="quickFilter"></label><input type="text" id="quickFilter" aria-label="Search emails" placeholder="Search emailsâ€¦ (subject/body/sender)"
        onkeyup="onQuickFilterChanged()" />
    </div>

    <!-- Filter Assistant (Smart / AI) -->
    <div class="btn-group">
      <button class="btn btn-primary" onclick="openFilterAssistant()" title="Guided natural-language filtering (Smart + AI)">
        <i class="fas fa-wand-magic-sparkles"></i> Filter assistant
      </button>
      <button class="btn btn-icon btn-ghost" onclick="showFilterAssistantHelp()" title="What does Search vs Filter do?">
        <i class="fas fa-circle-question"></i>
      </button>
    </div>

    <!-- Advanced Filter Toggle -->
    <div class="btn-group">
      <button class="btn btn-primary" onclick="toggleAdvancedFilter()" title="Open Advanced Filter Builder">
        <i class="fas fa-wand-magic-sparkles"></i> Advanced Filter
      </button>
      <button class="btn btn-icon btn-ghost" onclick="showAdvancedFilterHelp()" title="Learn about Advanced Filter">
        <i class="fas fa-circle-question"></i>
      </button>
    </div>

    <!-- Upload Actions -->
    <div class="toolbar-dropdown" id="uploadDropdown">
      <button class="btn btn-primary" onclick="toggleUploadDropdown()" title="Upload Data">
        <i class="fas fa-cloud-upload-alt"></i> Upload
      </button>
      <div class="dropdown-menu" id="uploadDropdownMenu">
        <button class="dropdown-item" onclick="window.location.href='pst-upload.html'; closeAllDropdowns()">
          <i class="fas fa-envelope"></i> Upload PST (Email)
        </button>
        <button class="dropdown-item" onclick="uploadProgramme(); closeAllDropdowns()">
          <i class="fas fa-project-diagram"></i> Upload Programme
        </button>
      </div>
    </div>

    <!-- Essential Filters -->
    <div class="toolbar-dropdown" id="filterDropdown">
      <button class="btn" onclick="toggleFilterDropdown()" title="Quick filters (Stakeholder / Keyword)">
        <i class="fas fa-filter"></i> Quick filters
      </button>
      <div class="dropdown-menu" id="filterDropdownMenu">
        <button class="dropdown-item" onclick="showStakeholderFilter(); closeAllDropdowns()">
          <i class="fas fa-id-badge"></i> By Stakeholder
        </button>
        <button class="dropdown-item" onclick="showKeywordFilter(); closeAllDropdowns()">
          <i class="fas fa-tags"></i> By Keyword
        </button>
      </div>
    </div>
  </div>

  <div class="toolbar-right">
    <button class="btn" onclick="openVeriCaseAnalysis()" title="VeriCase Analysis">
      <i class="fas fa-microscope"></i> VeriCase Analysis
    </button>
    <button class="btn btn-icon" onclick="refreshData()" title="Refresh Data">
      <i class="fas fa-sync-alt"></i>
    </button>
    <button class="btn btn-icon btn-ghost" onclick="toggleCommandPalette()" title="Command Palette (Ctrl+K)">
      <i class="fas fa-terminal"></i>
    </button>

    <!-- Expand/Collapse All Bodies -->
    <div class="btn-group">
      <button class="btn btn-icon" onclick="expandAllBodies()" title="Expand all email bodies">
        <i class="fas fa-expand-alt"></i>
      </button>
      <button class="btn btn-icon" onclick="collapseAllBodies()" title="Collapse all email bodies">
        <i class="fas fa-compress-alt"></i>
      </button>
    </div>

    <!-- View Mode -->
    <div class="btn-group view-toggle-group">
      <button class="btn active" onclick="setViewMode('all')" data-view="all" title="All">
        <i class="fas fa-inbox"></i>
      </button>
      <button class="btn" onclick="setViewMode('threads')" data-view="threads" title="Threads">
        <i class="fas fa-comments"></i>
      </button>
      <button class="btn" onclick="setViewMode('attachments')" data-view="attachments" title="Files">
        <i class="fas fa-paperclip"></i>
      </button>
    </div>

    <!-- Selection Actions -->
    <div class="selection-actions" style="display: flex; align-items: center; gap: 8px; margin-right: 8px;">
      <span class="selection-info" id="toolbarSelectionInfo" style="font-size: 0.8125rem; color: var(--text-secondary); padding: 6px 12px; background: var(--gray-100); border-radius: var(--radius-md);">
        <span id="selectedCount">0</span> selected
      </span>
      <button class="btn" id="excludeToolbarBtn" onclick="markAsExcluded()" title="Mark selected emails as excluded" disabled style="color: #991b1b; background: #fef2f2; border-color: #fecaca;">
        <i class="fas fa-ban"></i> Exclude
      </button>
    </div>

    <button class="btn" id="linkToolbarBtn" onclick="openLinkModalForSelected()" title="Link selected emails to a Contentious Matter or Head of Claim" disabled>
      <i class="fas fa-link"></i> <span id="linkToolbarLabel">Link</span>
    </button>

    <button class="btn btn-icon" id="quickActionsToggle" onclick="toggleContextPanel()" title="Toggle Quick Actions">
      <i class="fas fa-bolt"></i>
    </button>

    <!-- Views -->
    <div class="toolbar-dropdown" id="moreActionsDropdown">
      <button class="btn" onclick="toggleMoreActionsDropdown()" title="Views">
        <i class="fas fa-layer-group"></i> Views
      </button>
      <div class="dropdown-menu dropdown-menu-right" id="moreActionsMenu">
        <button class="dropdown-item" onclick="openTableSettings(); closeAllDropdowns()">
          <i class="fas fa-sliders-h"></i> Table Settings
        </button>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item" onclick="saveGridConfiguration(); closeAllDropdowns()">
          <i class="fas fa-save"></i> Save Current View
        </button>
        <button class="dropdown-item" onclick="openManageViews(); closeAllDropdowns()">
          <i class="fas fa-layer-group"></i> Manage Views
        </button>
        <button class="dropdown-item" onclick="resetGridConfiguration(); closeAllDropdowns()">
          <i class="fas fa-undo"></i> Reset to Default
        </button>
        <div class="dropdown-divider"></div>
        <div id="viewsDropdownList"></div>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item" onclick="openProgrammeModal(); closeAllDropdowns()">
          <i class="fas fa-project-diagram"></i> Manage Programmes
        </button>
      </div>
    </div>
  </div>
</div>


