<div class="toolbar">
  <div class="toolbar-left">
    <!-- Search -->
    <div class="search-box">
      <i class="fas fa-search"></i>
      <label for="quickFilter"></label><input type="text" id="quickFilter" placeholder="Search emails... (Ctrl+K)"
        onkeyup="onQuickFilterChanged()" />
    </div>

    <!-- Smart Filter -->
    <div class="smart-filter" title="Natural language filter: 'Smith' in subject, from John last 30 days, with attachments">
      <i class="fas fa-magnifying-glass"></i>
      <label for="smartFilterInput"></label><input
        type="text"
        id="smartFilterInput"
        placeholder="Smart filter: 'Smith' in subject, from John, last 7 days, with attachments..."
        onkeydown="if (event.key === 'Enter') { event.preventDefault(); applySmartFilter(); }"
      />
      <button class="btn btn-primary btn-sm" onclick="applySmartFilter()" title="Apply smart filter">
        <i class="fas fa-check"></i> Apply
      </button>
      <button class="btn btn-ghost btn-sm" onclick="clearSmartFilter()" title="Clear smart filter">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <!-- Advanced Filter Toggle -->
    <div class="btn-group">
      <button class="btn btn-primary" onclick="toggleAdvancedFilter()" title="Open Advanced Filter Builder">
        <i class="fas fa-wand-magic-sparkles"></i> Advanced Filter
      </button>
      <button class="btn btn-icon btn-ghost" onclick="showAdvancedFilterHelp()" title="Learn about Advanced Filter">
        <i class="fas fa-circle-question"></i>
      </button>
    </div>

    <!-- AI Query (AWS Bedrock powered) -->
    <div class="ai-query-box" id="aiQueryBox">
      <i class="fas fa-robot" style="color: var(--vericase-teal);"></i>
      <input
        type="text"
        id="aiQueryInput"
        placeholder="AI: 'emails from John about payment in 2024...'"
        onkeydown="if (event.key === 'Enter') { event.preventDefault(); executeAIQuery(); }"
      />
      <button class="btn btn-accent btn-sm" onclick="executeAIQuery()" title="Ask AI to filter">
        <i class="fas fa-bolt"></i> AI Filter
      </button>
      <span id="aiQueryStatus" class="ai-query-status"></span>
    </div>

    <!-- Essential Filters -->
    <div class="toolbar-dropdown" id="filterDropdown">
      <button class="btn" onclick="toggleFilterDropdown()" title="Filter">
        <i class="fas fa-filter"></i> Filter
      </button>
      <div class="dropdown-menu" id="filterDropdownMenu">
        <button class="dropdown-item" onclick="showStakeholderFilter(); closeAllDropdowns()">
          <i class="fas fa-id-badge"></i> By Stakeholder
        </button>
        <button class="dropdown-item" onclick="showKeywordFilter(); closeAllDropdowns()">
          <i class="fas fa-tags"></i> By Keyword
        </button>
      </div>
    </div>
  </div>

  <div class="toolbar-right">
    <button class="btn" onclick="openVeriCaseAnalysis()" title="VeriCase Analysis">
      <i class="fas fa-microscope"></i> VeriCase Analysis
    </button>
    <button class="btn btn-icon" onclick="refreshData()" title="Refresh Data">
      <i class="fas fa-sync-alt"></i>
    </button>
    <button class="btn btn-icon btn-ghost" onclick="toggleCommandPalette()" title="Command Palette (Ctrl+K)">
      <i class="fas fa-terminal"></i>
    </button>

    <!-- Expand/Collapse All Bodies -->
    <div class="btn-group">
      <button class="btn btn-icon" onclick="expandAllBodies()" title="Expand all email bodies">
        <i class="fas fa-expand-alt"></i>
      </button>
      <button class="btn btn-icon" onclick="collapseAllBodies()" title="Collapse all email bodies">
        <i class="fas fa-compress-alt"></i>
      </button>
    </div>

    <!-- View Mode -->
    <div class="btn-group view-toggle-group">
      <button class="btn active" onclick="setViewMode('all')" data-view="all" title="All">
        <i class="fas fa-inbox"></i>
      </button>
      <button class="btn" onclick="setViewMode('threads')" data-view="threads" title="Threads">
        <i class="fas fa-comments"></i>
      </button>
      <button class="btn" onclick="setViewMode('attachments')" data-view="attachments" title="Files">
        <i class="fas fa-paperclip"></i>
      </button>
    </div>

    <button class="btn" id="linkToolbarBtn" onclick="openLinkModalForSelected()" title="Link selected emails to a Contentious Matter or Head of Claim" disabled>
      <i class="fas fa-link"></i> <span id="linkToolbarLabel">Link</span>
    </button>

    <button class="btn btn-icon" id="quickActionsToggle" onclick="toggleContextPanel()" title="Toggle Quick Actions">
      <i class="fas fa-bolt"></i>
    </button>

    <!-- Views -->
    <div class="toolbar-dropdown" id="moreActionsDropdown">
      <button class="btn" onclick="toggleMoreActionsDropdown()" title="Views">
        <i class="fas fa-layer-group"></i> Views
      </button>
      <div class="dropdown-menu dropdown-menu-right" id="moreActionsMenu">
        <button class="dropdown-item" onclick="openTableSettings(); closeAllDropdowns()">
          <i class="fas fa-sliders-h"></i> Table Settings
        </button>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item" onclick="saveGridConfiguration(); closeAllDropdowns()">
          <i class="fas fa-save"></i> Save Current View
        </button>
        <button class="dropdown-item" onclick="openManageViews(); closeAllDropdowns()">
          <i class="fas fa-layer-group"></i> Manage Views
        </button>
        <button class="dropdown-item" onclick="resetGridConfiguration(); closeAllDropdowns()">
          <i class="fas fa-undo"></i> Reset to Default
        </button>
        <div class="dropdown-divider"></div>
        <div id="viewsDropdownList"></div>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item" onclick="openProgrammeModal(); closeAllDropdowns()">
          <i class="fas fa-project-diagram"></i> Manage Programmes
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Statistics Bar - Card Style -->
<div class="stats-bar">
  <div class="stat-item">
    <span class="stat-label">Total Emails</span>
    <span class="stat-value highlight" id="totalEmails">0</span>
  </div>
  <div class="stat-item">
    <span class="stat-label">Excluded</span>
    <span class="stat-value" id="excludedCount">0</span>
  </div>
  <div class="stat-item">
    <span class="stat-label">Threads</span>
    <span class="stat-value" id="uniqueThreads">0</span>
  </div>
  <div class="stat-item">
    <span class="stat-label">Attachments</span>
    <span class="stat-value" id="withAttachments">0</span>
  </div>
  <div class="stat-item">
    <span class="stat-label">Date Range</span>
    <span class="stat-value" id="dateRange">-</span>
  </div>
  <div class="stat-item">
    <span class="stat-label">Selected</span>
    <span class="stat-value" id="selectedCount">0</span>
  </div>
</div>
