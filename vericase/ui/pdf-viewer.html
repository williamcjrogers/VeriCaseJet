<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>PDF Preview</title>
    <link rel="stylesheet" href="./assets/fontawesome/css/all.min.css" />
    <link rel="stylesheet" href="brand-styles.css?v=9" />
    <script src="nav-shell.js"></script>
    <style>
      body {
        margin: 0;
        background: var(--bg-primary);
        color: var(--text-primary);
        font-family: var(--font-sans);
      }
      #toolbar {
        background: var(--bg-elevated);
        border-bottom: 1px solid var(--border-default);
        padding: 10px 12px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 10;
        display: flex;
        align-items: center;
        gap: 8px;
      }
      #viewer {
        position: absolute;
        top: 48px;
        bottom: 0;
        left: 0;
        right: 0;
        overflow: auto;
        padding: 16px;
      }
      canvas {
        display: block;
        margin: 0 auto 12px;
        background: var(--bg-elevated);
        border: 1px solid var(--border-default);
        border-radius: var(--radius-lg);
        box-shadow: var(--shadow-md);
      }
      button {
        padding: 6px 10px;
        border-radius: var(--radius-md);
        border: 1px solid var(--border-default);
        background: var(--bg-elevated);
        color: var(--text-secondary);
        font-weight: 600;
        cursor: pointer;
      }
      button:hover {
        background: var(--gray-50);
        color: var(--text-primary);
      }
    </style>
  </head>
  <body>
    <div id="toolbar">
      <button id="prev">Prev</button>
      <span id="page_num">1</span>/<span id="page_count">?</span>
      <button id="next">Next</button>
      <span style="margin-left: 16px">Zoom:</span>
      <button id="zoom_out">-</button>
      <button id="zoom_in">+</button>
    </div>
    <div id="viewer"><canvas id="the-canvas"></canvas></div>

    <script type="module">
      import * as pdfjsLib from "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.min.mjs";

      // Configure PDF.js worker
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdn.jsdelivr.net/npm/pdfjs-dist@4.7.76/build/pdf.worker.min.mjs";

      const params = new URLSearchParams(location.search);
      const url = params.get("file");
      if (!url) {
        document.body.innerHTML =
          '<div style="padding:20px">No file URL provided.</div>';
        throw new Error("No file param");
      }

      let pdfDoc = null,
        pageNum = 1,
        scale = 1.2;
      const canvas = document.getElementById("the-canvas");
      const ctx = canvas.getContext("2d");

      async function renderPage(num) {
        const page = await pdfDoc.getPage(num);
        const viewport = page.getViewport({ scale });
        canvas.width = viewport.width;
        canvas.height = viewport.height;
        await page.render({ canvasContext: ctx, viewport }).promise;
        document.getElementById("page_num").textContent = num;
        document.getElementById("page_count").textContent = pdfDoc.numPages;
      }

      async function load() {
        try {
          pdfDoc = await pdfjsLib.getDocument({ url, withCredentials: false })
            .promise;
          renderPage(pageNum);
        } catch (e) {
          document.getElementById("viewer").innerHTML =
            '<div style="padding:20px">Failed to load PDF. ' + e + "</div>";
        }
      }

      document.getElementById("prev").onclick = () => {
        if (pageNum > 1) {
          pageNum--;
          renderPage(pageNum);
        }
      };
      document.getElementById("next").onclick = () => {
        if (pageNum < pdfDoc.numPages) {
          pageNum++;
          renderPage(pageNum);
        }
      };
      document.getElementById("zoom_in").onclick = () => {
        scale *= 1.2;
        renderPage(pageNum);
      };
      document.getElementById("zoom_out").onclick = () => {
        scale = Math.max(0.2, scale / 1.2);
        renderPage(pageNum);
      };

      load();
    </script>
  </body>
</html>
